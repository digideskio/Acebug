<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Editor</title>

    <link rel="stylesheet" href="styles.css" type="text/css" media="screen" charset="utf-8">
</head>
<body>
    <div id="editor">
		<div id="toggleGutter" onclick="toggleGutter();"></div>
	</div>

    <script type="text/javascript">

function transformPath(path){
	var aceRoot = '../ace/build/src/'
	var sub = 'ace/theme/'
	if(path.indexOf(sub)==0){
		return aceRoot + 'theme-' + path.substr(sub.length) + '.js'
	}
	var sub = 'ace/keyboard/keybinding/'
	if(path.indexOf(sub)==0){
		return aceRoot + 'keybinding-' + path.substr(sub.length) + '.js'
	}
	var sub = 'ace/mode/'
	if(path.indexOf(sub)==0){
		return aceRoot + 'mode-' + path.substr(sub.length) + '.js'
	}
	var sub = 'fbace/'
	if(path.indexOf(sub)==0){
		return path.substr(sub.length) + '.js'
	}
	return aceRoot + path + '.js'	
}

require = loadScripts = function(deps, callback, lastUrl){
	//console.log(deps)
	if(typeof deps == 'string')//this happens when module's path is wrong
		return;
		
	var url = deps.shift()
	if(!url)
		return callback&&callback(require(lastUrl))
	
	
	var script = document.createElement("script")
	script.type = "text/javascript";	  
	script.onload = function(){
		loadScripts(deps, callback, url)
	}
   
	script.src = transformPath(url);
	document.documentElement.appendChild(script);	
}



var startAce = function(callback, options) {
	var rootDeps = ['ace', "ace/mode/javascript", "fbace/startup"];
	//"ace/theme/textmate" is built into ace.js so there's no need to load that
	if(!options.theme)
		options.theme = "ace/theme/textmate"
	else if(options.theme != "ace/theme/textmate")
		rootDeps.push(options.theme)

	require(rootDeps, function() {
		var catalog = require("pilot/plugin_manager").catalog;
		catalog.registerPlugins([ "pilot/index" ]).then(function() {
			var env = require("pilot/environment").create();
			catalog.startupPlugins({ env: env }).then(function() {
				require("fbace/startup").launch(env, options);
			}).then(callback);
		});
	});
};
	</script>
</body>
</html>
